@page "/cybersec"
@using System.Text.Json
@using BlazorApp1.models.DTO
@using Newtonsoft.Json.Linq
@inject IHttpClientFactory ClientFactory

<body>
<h3>CyberSec</h3>
security is such cool
</body>
<!-- TODO: event Timeline for CVE -->

<MudPaper Elevation="0" Square="true">
    <MudText>CVE severity </MudText>
    <MudAlert Severity="Severity.Info">Please note: i am working on my own CVE search, and i as i have not figured it quite out right now, you will se a error, this due to a gigantic object that i hope to fix soon!</MudAlert>
    @if (err)
    {
        <MudAlert Severity="Severity.Error"> error loading the external API, please let the creator know</MudAlert>
    }
    else if (cveTest == null)
    {
        <MudProgressCircular>loading...</MudProgressCircular>
    } else
    {
        @foreach (var cv in cveTest)
        {
            <MudText>cv</MudText>
        }
    }
  
</MudPaper>

@code {

    //add api calls to this 
    private IEnumerable<List<CVEdto>>? cveTest = [];
    bool err = false; 
    protected override async Task OnInitializedAsync()
    {
        var req = new HttpRequestMessage(HttpMethod.Get, "https://services.nvd.nist.gov/rest/json/cves/2.0/?resultsPerPage=25");
        req.Headers.Add("Accept", "application/json");
        var client = ClientFactory.CreateClient();
        var res = await client.SendAsync(req);
        if (res.IsSuccessStatusCode)
        {
           // Console.WriteLine("OK babaush");
            var responseStream = await res.Content.ReadAsStreamAsync(); 
            cveTest = await JsonSerializer.DeserializeAsync<IEnumerable<List<CVEdto>>>(responseStream);
        }
        else
        {
            err = true;
        }
    }

}
}